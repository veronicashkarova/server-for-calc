# server-for-calc

## $\color{grey}РАСПРЕДЕЛЕННЫЙ \space  ВЫЧИСЛИТЕЛЬ \space  АРИФМЕТИЧЕСКИХ \space ВЫРАЖЕНИЙ$

Данный сервер решает арифметические действия с числами, также учитывая скобки и другие арифметические знаки.

Сервер проверяет выражение на такие ошибки: некорректное выражение, пустое выражение.

Он состоит из двух частей (модулей):
- Сервер, который принимает арифметическое выражение, переводит его в набор последовательных задач и обеспечивает порядок их выполнения(оркестратор). Расположен в директории orkestrator
- Вычислитель, который может получить от оркестратора задачу, выполнить его и вернуть серверу результат(агент). Расположен в директории agent

#
Для запуска оркестратора выполнить команду в директории orkestrator проекта:
```
go run ./cmd/main.go
```
при старте оркестратора в терминале выdодится строка "Server started"

#
Для запуска агента выполнить команду в директории agent проекта (в отдельном терминале):
```
go run ./cmd/main.go
```

## $\color{grey}СХЕМА \space  ПРОЕКТА$
![telegram-cloud-photo-size-2-5348327795534720734-y](https://github.com/user-attachments/assets/1d0917b1-f5e6-4cfb-a7cb-936f7da1ea69)

## $\color{grey}ОРКЕСТРАТОР$

Для добавления вычисления арифметического выражения:
```
curl --location 'localhost/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
   "expression": "2+2"
}'
```
Коды ответа: 201 - выражение принято для вычисления, 422 - невалидные данные, 500 - что-то пошло не так

Пример ответа
```
{"id":"1"}
```
#
Для получения списка выражений:
```
curl --location 'localhost/api/v1/expressions'
```
Коды ответа: 200 - успешно получен список выражений, 500 - что-то пошло не так

Пример ответа
```
{
    "expressions": [
        {
            "id": "1",
            "status": "Выполнено",
            "result": "4.000"
        },
        {
            "id": "2",
            "status": "в процессе выполнения",
            "result": "Неизвестно"
        },
        {
            "id": "3",
            "status": "в процессе выполнения",
            "result": "Неизвестно"
        }
    ]
}
```
#
Для получения выражения по его идентификатору;
```
curl --location 'localhost/api/v1/expressions/:id'
```
Коды ответа: 200 - успешно получено выражение, 404 - нет такого выражения, 500 - что-то пошло не так

## $\color{grey}АГЕНТ$

При запуске агент запускает несколько горутин и вычисляет выражения с заданной в таске задержкой. При отсуствии задач в оркестраторе агент увеличивает задержку между запросами до 5 сек.
#
Для получения задачи для выполнения:
```
curl --location 'localhost/internal/task'
```

#
Прием результата обработки данных:
```
curl --location 'localhost/internal/task' \
--header 'Content-Type: application/json' \
--data '{
  "id": 1,
  "result": 2.5
}'
```
Коды ответа: 200 - успешно записан результат, 404 - нет такой задачи, 422 - невалидные данные, 500 - что-то пошло не так

## $\color{grey}Ошибки$
При невалидном выражении, например
```
curl --location --request GET 'localhost/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
    "expression": "5-+"
}'
```
в статусе задачи будет выведена ошибка
```
{
    "expressions": [
        {
            "id": "1",
            "status": "неправильное выражение",
            "result": "Неизвестно"
        }
    ]
}
```
Примеры выводимых ошибок:
- неправильное выражение
- деление на ноль
- неправильный символ
- не хватает скобки
- пустое выражение
- не найдено выражение
- нет доступных задач
